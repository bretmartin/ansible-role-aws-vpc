---

- name: configure VPC
  ec2_vpc_net:
    profile:        '{{ aws_profile }}'
    aws_access_key: '{{ aws_iam_assume_role_access_key    | default(omit) }}'
    aws_secret_key: '{{ aws_iam_assume_role_secret_key    | default(omit) }}'
    security_token: '{{ aws_iam_assume_role_session_token | default(omit) }}'

    name: '{{ aws_vpc_name }}'
    cidr_block: '{{ aws_vpc_cidr_block }}'
    region: '{{ aws_region }}'
    state: present
  register: _aws_vpc_configuration

- name: set VPC ID fact
  set_fact:
    _aws_vpc_id: '{{ _aws_vpc_configuration.vpc.id }}'

- name: call optional notifier
  include_tasks: 'roles/{{ notifier_role }}/tasks/main.yml'
  vars:
     message: >
       created <a href="{{ _aws_vpc_url }}">VPC {{ aws_vpc_name }}</a>
  when: >
    notifier_role is defined and
    _aws_vpc_configuration.changed
